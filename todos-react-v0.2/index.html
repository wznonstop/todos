<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>todos-react</title>
	<script src="src/react.js"></script> 
	<script src="src/JSXTransformer.js"></script>
</head>
<body>
	<div id="container"></div>
	<script type="text/jsx">
		/* [TODO APP] */
		var TodoApp = React.createClass({
			getInitialState: function(){
				return {
					todoList: [{
						name: 'walk through',
						complete: false,
						editing: false
					},{
						name: 'lay down',
						complete: false,
						editing: false
					}],
					todoText: "",
					completeAll: false,
					todoMode: 'all'
				};
			},

			checkCompleteAll: function(todoList){
				if (todoList.length < 1) {
					return false;
				};
				return todoList.every(function(item){
					return item.complete === true;
				})
			},

			handleAddTodo: function(event){
				event.preventDefault();
				var newTodoName = this.state.todoText.trim();
				if (newTodoName) {
					var todoList = this.state.todoList.concat([{
						name: newTodoName,
						complete: false,
						editing: false
					}]);
					this.setState({
						todoList: todoList,
						todoText: "",
						completeAll: this.checkCompleteAll(todoList)
					})
				};
			},

			handleChangeCompleteAll: function(event){
				this.setState({
					completeAll: !this.state.completeAll,
					todoList: this.state.todoList.map(function(item){
						item.complete = !this.state.completeAll;
						return item;
					}.bind(this))
				})
			},

			handleChangeTodoText: function(event){
				this.setState({
					todoText: event.target.value
				})
			},

			handleRemoveTodo: function(index){
				var todoList = this.state.todoList.filter(
					function(item, i){
						return i !== index
					}
				);
				this.setState({
					todoList: todoList,
					completeAll: this.checkCompleteAll(todoList)
				})
			},

			handleChangeComplete: function(index){
				var todoList = this.state.todoList.map(function(item, i){
					if (i === index) {
						item.complete = !item.complete
					};
					return item;
				});
				this.setState({
					todoList: todoList,
					completeAll: this.checkCompleteAll(todoList)
				})
			},

			handleUpdateTodo: function(i, val){
				var todoList = this.state.todoList.map(function(item, index){
					if (index === i) {
						item.name = val;
					};
					return item;
				});
				this.setState({
					todoList: todoList
				})
			},

			handleEdit: function(index){
				var todoList = this.state.todoList.map(function(item, i){
					if (i === index) {
						item.editing = !item.editing
					};
					return item;
					this.setState({
						todoList: todoList
					})
				})
			}

			handleChangeMode: function(event){
				this.setState({
					todoMode: event.target.value
				})
			},

			render: function(){
				return (
					<div className="todoapp">
						<form onSubmit={this.handleAddTodo}>
						<input 
							type="checkbox"
							checked={this.state.completeAll}
							onChange={this.handleChangeCompleteAll}
							className={this.state.todoList.length > 0 ? 'toggle-all' : 'hide'}
							id="toggle-all"
						/>
						<input 
							type="text"
							ref="inputAddTodo"
							placeholder="What's new"
							value={this.state.todoList}
							onChange={this.handleChangeTodoText}
							className="new-todo"
						/>
						</form>
						<TodoList 
							todoList={this.state.todoList}
							handleRemoveTodo={this.handleRemoveTodo}
							handleChangeComplete={this.handleChangeComplete}
							handleUpdateTodo={this.handleUpdateTodo}
							handleEdit={this.handleEdit}
							todoMode={this.state.todoMode}
						/>
						<div className={(this.state.todoList.length > 0) ? 'footer': 'hide'}>
							<label className="todo-count">
								{this.state.todoList.length}
								{(this.state.todoList.length > 1) ? " items left" : " item left"}
							</label>

							<form className="filters">
								<input
									type="radio"
									value="all"
									name="mode"
									id="r1"
									defaultChecked={true}
									onChange={this.handleChangeMode}
									hidden
								 />
								 <label
								 	htmlFor="r1"
								 	className{this.state.todoMode === 'all' ? 'active' : null}
								 >All</label>
								 <input 
								 	type="radio"
								 	value="active"
								 	name="mode"
								 	id="r2"
								 	onChange={this.handleChangeMode}
								 	hidden
								 />
								 <label
								 	htmlFor="r2"
								 	className={this.state.todoMode === 'active' : null}
								 >Active</label>
								 <input 
								 	type="radio"
								 	value="complete"
								 	name="mode"
								 	id="r3"
								 	onChange={this.handleChangeMode}
								 	hidden
								 />
								 <label
								 	htmlFor="r3"
								 	className={this.state.todoMode === 'complete' ? 'active' :null}
								 >Complete</label>
							</form>
							<a>Clear completed</a>
						</div>
					</div>
				)
			}
		});

		var TodoList = React.createClass({
			render: function(){
				var todoNodes = this.props.todoList;
				if (this.props.todoMode === 'active') {
					todoNodes = todoNodes.filter(function(item){
						return item.complete === false;
					})
				}else if (this.props.todoMode === 'complete') {
					todoNodes = todoNodes.filter(function(item){
						return item.complete === true;
					})
				};
				todoNodes = todoNodes.map(function(item, index){
					return (
						<TodoItem 
							todo={item}
							key={index}
							handleRemoveTodo={this.props.handleRemoveTodo.bind(null, index)}
							handleChangeComplete={this.props.handleChangeComplete.bind(null, index)}
							handleUpdateTodo={this.props.handleUpdateTodo=this.props.handleUpdateTodo.bind(null, index)}
							handleEdit={this.props.handleEdit.bind(null, index)}
						/>
					)
				}.bind(this));

				return (
					<div className="main">
						<ul className="todo-list">
							{todoNodes}
						</ul>
					</div>
				)
			}
		});

		var TodoItem = React.createClass({
			render: function(){
				var classString = this.props.todo.editing ? 'editing' :'';
				if (this.props.todo.complete) {
					classString += ' completed'
				}
				return(
					<li className={classString}>
						<div className="view">
							<input
								type="checkbox"
								checked={this.props.todo.complete}
								onChange={this.props.handleChangeComplete}
								className="toggle"
							 />
							 <label
							 	onDoubleClick={this.props.handleEdit}
							 	className="view"
							 >
							 	{this.props.todo.name}
							 </label>
							 <button 
							 	type="button"
							 	onClick={this.props.handleRemoveTodo}
							 	className="destory"
							 ></button>
						</div>
						 <input 
						 	type="text"
						 	value={this.props.todo.name}
						 	onChange={this.handle}
						 />
					</li>
				)
			}
		})


		React.render(
			<TodoApp />,
			document.getElementById('container')
		)

	</script>
</body>
</html>